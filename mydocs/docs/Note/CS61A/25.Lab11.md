# Lab11 & Project04

## Q3: Evaluating Call Expressions

ä»¥ç¬¬ä¸‰é¢˜ä¸ºä¾‹ï¼Œåˆ†æžä¸€ä¸‹labä»£ç çš„æž„æˆï¼š

```python
class CallExpr(Expr):
    
    def __init__(self, operator, operands):
        Expr.__init__(self, operator, operands)
        self.operator = operator
        self.operands = operands

    def eval(self, env):
        """
        >>> from reader import read
        >>> new_env = global_env.copy()
        >>> new_env.update({'a': Number(1), 'b': Number(2)})
        >>> add = CallExpr(Name('add'), [Literal(3), Name('a')])
        >>> add.eval(new_env)
        Number(4)
        >>> new_env['a'] = Number(5)
        >>> add.eval(new_env)
        Number(8)
        >>> read('max(b, a, 4, -1)').eval(new_env)
        Number(5)
        >>> read('add(mul(3, 4), b)').eval(new_env)
        Number(14)
        """
        "*** YOUR CODE HERE ***"
```

> `env`å®žé™…ä¸Šå–è‡ª`environment`ï¼Œè¡¨ç¤ºå½“å‰çŽ¯å¢ƒ

æœ¬é¢˜è¦è¯„ä¼°ä¸€ä¸ª`CallExpr`ï¼Œæ­¥éª¤åº”è¯¥å¦‚ä¸‹ï¼š

- ==å…ˆè¯„ä¼°è°ƒç”¨è¡¨è¾¾å¼çš„æ“ä½œç¬¦ï¼Œå¾—åˆ°ä¸€ä¸ªå‡½æ•°å¯¹è±¡==

  ä¾‹å¦‚ï¼š`expr = CallExpr(Name('add'), [Name('one'), Name('two')])`ï¼Œæ¬²è°ƒç”¨`expr.eval(env)`ï¼Œåˆ™å…ˆåº”å°†å…¶æ“ä½œç¬¦è½¬åŒ–ä¸ºå‡½æ•°ï¼Œæ‰€ä»¥å†™ä½œï¼š

  ```python
  func = self.operator.eval(env)
  ```

  `self.operator`æ˜¯`Name('add')`ï¼Œå¯¹`Name('add')`è°ƒç”¨`eval`è¯„ä¼°åˆ™åœ¨çŽ¯å¢ƒ`env`ä¸­æŸ¥æ‰¾`'add'`ï¼Œå¹¶è¿”å›žä¸Žä¹‹å¯¹åº”çš„`LambdaFunction`å¯¹è±¡

- ==å†è¯„ä¼°è°ƒç”¨è¡¨è¾¾å¼çš„æ“ä½œæ•°ï¼Œå¾—åˆ°å‚æ•°åˆ—è¡¨==

  ```python
  args = [operand.eval(env) for operand in self.operands]
  ```

  `Name('one').eval(env)`è¿”å›ž`Number(1)`ï¼Œ`Name('two').eval(env)`è¿”å›ž`Number(2)`

- ==æœ€åŽè°ƒç”¨å‡½æ•°å¯¹è±¡ï¼Œå°†å‚æ•°ä¼ é€’ç»™å®ƒï¼Œå¹¶è¿”å›žç»“æžœ==

  ```python
  return func.apply(args)
  ```



## Q4: Applying Lambda Functions

æœ¬é¢˜åªéœ€è¦åˆ›å»ºä¸€ä¸ªæ–°çš„çŽ¯å¢ƒï¼Œå°†å½“å‰å‡½æ•°çš„å‚æ•°ç»‘å®šåˆ°ä¼ é€’çš„å‚æ•°å€¼ä¸Šï¼Œæœ€åŽè¯„ä¼°å³å¯

```python
class LambdaFunction(Value):
    """A lambda function. Lambda functions are created in the LambdaExpr.eval
    method. A lambda function is a lambda expression that knows the
    environment in which it was evaluated in.

    The `parameters` attribute is a list of variable names (a list of strings).
    The `body` attribute is an instance of `Expr`, the body of the function.
    The `parent` attribute is an environment, a dictionary with variable names
        (strings) as keys and instances of the class Value as values.
    """
    def __init__(self, parameters, body, parent):
        Value.__init__(self, parameters, body, parent)
        self.parameters = parameters
        self.body = body
        self.parent = parent

    def apply(self, arguments):
        
        if len(self.parameters) != len(arguments):
            raise TypeError("Oof! Cannot apply number {} to arguments {}".format(
                comma_separated(self.parameters), comma_separated(arguments)))
        new_env = self.parent.copy()
        new_env.update(zip(self.parameters, arguments))
        return self.body.eval(new_env)
```

è¡¥å……ä¸€ä¸‹`zip`ï¼ˆä¹‹å‰çš„ [Decomposition & Data example](https://q1ucheng.github.io/blogs/Note/CS61A/20.Decomposition/#data-example) ä¸­æåˆ°è¿‡`zip`ï¼‰å’Œ`update`ï¼š

??? Note "è¡¥å……ï¼ˆæ¥è‡ªGPT-4oï¼‰"

	`zip` å‡½æ•°æ˜¯ Python å†…ç½®å‡½æ•°ï¼Œç”¨äºŽå°†å¤šä¸ªå¯è¿­ä»£å¯¹è±¡ï¼ˆå¦‚åˆ—è¡¨ã€å…ƒç»„ç­‰ï¼‰â€œåŽ‹ç¼©â€åœ¨ä¸€èµ·ï¼Œç”Ÿæˆä¸€ä¸ªæ–°çš„è¿­ä»£å™¨ã€‚è¿™ä¸ªè¿­ä»£å™¨ä¸­çš„æ¯ä¸ªå…ƒç´ éƒ½æ˜¯ä¸€ä¸ªå…ƒç»„ï¼ŒåŒ…å«æ¥è‡ªè¾“å…¥å¯è¿­ä»£å¯¹è±¡ä¸­å¯¹åº”ä½ç½®çš„å…ƒç´ ã€‚
	
	è¯­æ³•
	```python
	zip(*iterables)
	```
	
	`*iterables`: ä¸€ä¸ªæˆ–å¤šä¸ªå¯è¿­ä»£å¯¹è±¡ã€‚
	
	è¿”å›žå€¼
	- è¿”å›žä¸€ä¸ªè¿­ä»£å™¨ï¼Œå…¶ä¸­æ¯ä¸ªå…ƒç´ æ˜¯ä¸€ä¸ªå…ƒç»„ï¼ŒåŒ…å«äº†æ¥è‡ªå„ä¸ªè¾“å…¥å¯è¿­ä»£å¯¹è±¡å¯¹åº”ä½ç½®çš„å…ƒç´ ã€‚
	
	1. **ç®€å•ç¤ºä¾‹**ï¼š
	    ```python
	    numbers = [1, 2, 3]
	    letters = ['a', 'b', 'c']
	
	    zipped = zip(numbers, letters)
	    print(list(zipped))  # è¾“å‡º: [(1, 'a'), (2, 'b'), (3, 'c')]
	    ```
	
	2. **ä¸åŒé•¿åº¦çš„å¯è¿­ä»£å¯¹è±¡**ï¼š
	    å¦‚æžœè¾“å…¥çš„å¯è¿­ä»£å¯¹è±¡é•¿åº¦ä¸åŒï¼Œ`zip` å‡½æ•°ä¼šæ ¹æ®æœ€çŸ­çš„è¾“å…¥è¿›è¡Œâ€œåŽ‹ç¼©â€ï¼š
	    ```python
	    numbers = [1, 2, 3, 4]
	    letters = ['a', 'b']
	
	    zipped = zip(numbers, letters)
	    print(list(zipped))  # è¾“å‡º: [(1, 'a'), (2, 'b')]
	    ```
	
	3. **ä¸Ž `dict` é…åˆä½¿ç”¨**ï¼š
	    `zip` å¸¸ç”¨äºŽå°†ä¸¤ä¸ªåˆ—è¡¨â€œåŽ‹ç¼©â€æˆä¸€ä¸ªå­—å…¸ï¼š
	    ```python
	    keys = ['name', 'age', 'city']
	    values = ['Alice', 25, 'New York']
	
	    dictionary = dict(zip(keys, values))
	    print(dictionary)  # è¾“å‡º: {'name': 'Alice', 'age': 25, 'city': 'New York'}
	    ```
	ä½¿ç”¨åœºæ™¯
	- **åˆå¹¶æ•°æ®**ï¼šå°†å¤šä¸ªç›¸å…³çš„å¯è¿­ä»£å¯¹è±¡åˆå¹¶åœ¨ä¸€èµ·ï¼Œä»¥ä¾¿åŽç»­æ“ä½œã€‚
	- **åˆ›å»ºå­—å…¸**ï¼šå°†ä¸¤ä¸ªåˆ—è¡¨â€œåŽ‹ç¼©â€æˆä¸€ä¸ªå­—å…¸ï¼Œæ–¹ä¾¿æ•°æ®æŸ¥æ‰¾ã€‚
	- **è¿­ä»£å¤šä¸ªå¯è¿­ä»£å¯¹è±¡**ï¼šåŒæ—¶è¿­ä»£å¤šä¸ªå¯è¿­ä»£å¯¹è±¡ï¼Œæ–¹ä¾¿æ¯”è¾ƒæˆ–å¤„ç†å¯¹åº”ä½ç½®çš„å…ƒç´ ã€‚
	
	------------
	
	`update` å‡½æ•°æ˜¯ Python å­—å…¸ (`dict`) å¯¹è±¡çš„ä¸€ä¸ªæ–¹æ³•ï¼Œç”¨äºŽå°†ä¸€ä¸ªå­—å…¸ä¸­çš„é”®å€¼å¯¹æ›´æ–°åˆ°å¦ä¸€ä¸ªå­—å…¸ä¸­ã€‚å¦‚æžœæœ‰ç›¸åŒçš„é”®ï¼Œ`update` æ–¹æ³•ä¼šç”¨æ–°å­—å…¸ä¸­çš„å€¼è¦†ç›–æ—§å­—å…¸ä¸­çš„å€¼ã€‚
	
	è¯­æ³•
	```python
	dict.update([other])
	```
	
	å‚æ•°
	- `other`ï¼šå¯ä»¥æ˜¯å¦ä¸€ä¸ªå­—å…¸æˆ–ä¸€ä¸ªåŒ…å«é”®å€¼å¯¹çš„å¯è¿­ä»£å¯¹è±¡ï¼ˆå¦‚åˆ—è¡¨æˆ–å…ƒç»„ï¼‰ã€‚
	
	è¿”å›žå€¼
	- `None`ï¼šè¯¥æ–¹æ³•æ˜¯å°±åœ°ä¿®æ”¹å­—å…¸ï¼Œæ²¡æœ‰è¿”å›žå€¼ã€‚
	
	1. **ä½¿ç”¨å¦ä¸€ä¸ªå­—å…¸è¿›è¡Œæ›´æ–°**ï¼š
	    ```python
	    dict1 = {'a': 1, 'b': 2}
	    dict2 = {'b': 3, 'c': 4}
	
	    dict1.update(dict2)
	    print(dict1)  # è¾“å‡º: {'a': 1, 'b': 3, 'c': 4}
	    ```
	
	2. **ä½¿ç”¨å¯è¿­ä»£å¯¹è±¡è¿›è¡Œæ›´æ–°**ï¼š
	    - ä½¿ç”¨åŒ…å«é”®å€¼å¯¹çš„åˆ—è¡¨ï¼š
	      ```python
	      dict1 = {'a': 1, 'b': 2}
	      updates = [('b', 3), ('c', 4)]
	
	      dict1.update(updates)
	      print(dict1)  # è¾“å‡º: {'a': 1, 'b': 3, 'c': 4}
	      ```
	
	    - ä½¿ç”¨åŒ…å«é”®å€¼å¯¹çš„å…ƒç»„ï¼š
	      ```python
	      dict1 = {'a': 1, 'b': 2}
	      updates = (('b', 3), ('c', 4))
	
	      dict1.update(updates)
	      print(dict1)  # è¾“å‡º: {'a': 1, 'b': 3, 'c': 4}
	      ```
	
	3. **ä½¿ç”¨å…³é”®å­—å‚æ•°è¿›è¡Œæ›´æ–°**ï¼š
	    ```python
	    dict1 = {'a': 1, 'b': 2}
	
	    dict1.update(b=3, c=4)
	    print(dict1)  # è¾“å‡º: {'a': 1, 'b': 3, 'c': 4}
	    ```
	
	ä½¿ç”¨åœºæ™¯
	- **åˆå¹¶å­—å…¸**ï¼šå°†ä¸€ä¸ªå­—å…¸çš„å†…å®¹åˆå¹¶åˆ°å¦ä¸€ä¸ªå­—å…¸ä¸­ï¼Œä¾¿äºŽç®¡ç†å’Œæ›´æ–°æ•°æ®ã€‚
	- **è¦†ç›–æ›´æ–°**ï¼šæ›´æ–°å­—å…¸ä¸­çš„æŸäº›é”®å€¼å¯¹ï¼ŒåŒæ—¶ä¿ç•™å…¶ä»–é”®å€¼å¯¹ä¸å˜ã€‚
	- **åŠ¨æ€æ›´æ–°**ï¼šæ ¹æ®éœ€è¦åŠ¨æ€æ›´æ–°å­—å…¸ä¸­çš„å†…å®¹ï¼Œç‰¹åˆ«æ˜¯åœ¨å¤„ç†é…ç½®ã€çŠ¶æ€æˆ–å…¶ä»–éœ€è¦é¢‘ç¹å˜æ›´çš„æ•°æ®æ—¶ã€‚

----

## Project04 ï¼ˆPart III: Write Some Schemeï¼‰

### Q15

å®žçŽ° `enumerate` è¿‡ç¨‹ï¼Œè¯¥è¿‡ç¨‹æŽ¥å—ä¸€ä¸ªå€¼çš„åˆ—è¡¨ï¼Œå¹¶è¿”å›žä¸€ä¸ªç”±åŒå…ƒç´ åˆ—è¡¨ç»„æˆçš„åˆ—è¡¨ï¼Œå…¶ä¸­ç¬¬ä¸€ä¸ªå…ƒç´ æ˜¯å€¼çš„ç´¢å¼•ï¼Œç¬¬äºŒä¸ªå…ƒç´ æ˜¯å€¼æœ¬èº«ã€‚

```scheme
scm> (enumerate '(3 4 5 6))  
((0 3) (1 4) (2 5) (3 6))  
scm> (enumerate '())  
()  
```

å¯¹schemeç”¨æ³•æœ‰äº›æ·¡å¿˜äº†ï¼Œå¯¼è‡´å¡äº†è®¸ä¹…ðŸ˜‘

??? success "My solution"

	```scheme
	(define (enumerate lst)
	  (define (helper lst index)
	    (if (null? lst)
	         '()
	         (cons (list index (car lst))
	               (helper (cdr lst) (+ index 1)))))
	  (helper lst 0))
	```

### Q16

å®žçŽ° `merge` å‡½æ•°ï¼Œè¯¥å‡½æ•°æŽ¥å—ä¸€ä¸ªæ¯”è¾ƒå™¨å’Œä¸¤ä¸ªå·²æŽ’åºçš„åˆ—è¡¨å‚æ•°ï¼Œå¹¶å°†å®ƒä»¬åˆå¹¶æˆä¸€ä¸ªæŽ’åºåˆ—è¡¨ã€‚æ¯”è¾ƒå™¨æ˜¯ä¸€ä¸ªæ¯”è¾ƒä¸¤ä¸ªå€¼çš„å‡½æ•°ã€‚åœ¨è¿™é‡Œï¼Œå·²æŽ’åºæ˜¯æŒ‡æ ¹æ®æ¯”è¾ƒå™¨è¿›è¡ŒæŽ’åºã€‚ä¾‹å¦‚ï¼š

```scheme
scm> (merge < '(1 4 6) '(2 5 8))  
(1 2 4 5 6 8)  
scm> (merge > '(6 4 1) '(8 5 2))  
(8 6 5 4 2 1)  
```

??? success "My solution"

	```scheme
	(define (merge comp list1 list2)
	   (cond
		 ((null? list1) list2)
		 ((null? list2) list1)
		 ((comp (car list1) (car list2))
	 	  (cons (car list1) (merge comp (cdr list1) list2)))
		 (else
	       (cons (car list2) (merge comp list1 (cdr list2))))))
	```

### Q15

æ„Ÿè§‰æ˜¯æœ€æŠ½è±¡çš„ä¸€é¢˜ðŸ˜…

å®šä¹‰ä¸€ä¸ªå‡½æ•° `nondecreaselist`ï¼Œè¯¥å‡½æ•°æŽ¥æ”¶ä¸€ä¸ªæ•°å­—çš„æ–¹æ¡ˆåˆ—è¡¨ï¼Œå¹¶è¾“å‡ºä¸€ä¸ªåˆ—è¡¨çš„åˆ—è¡¨ï¼Œæ•´ä½“ä¸Šå…·æœ‰ç›¸åŒçš„æ•°å­—å’Œé¡ºåºï¼Œä½†åˆ†ç»„ä¸ºéžé€’å‡çš„åˆ—è¡¨ã€‚

ä¾‹å¦‚ï¼Œå¦‚æžœè¾“å…¥çš„åˆ—è¡¨åŒ…å«å…ƒç´  

```
(1 2 3 4 1 2 3 4 1 1 1 2 1 1 0 4 3 2 1)
```

é‚£ä¹ˆè¾“å‡ºåº”åŒ…å«å…ƒç´  

```
((1 2 3 4) (1 2 3 4) (1 1 1 2) (1 1) (0 4) (3) (2) (1))
```

```scheme
(define (nondecreaselist s)
  (cond
    ((null? (cdr s)) (list s))
    ((> (car s) (car (cdr s)))
      (cons (list (car s)) (nondecreaselist (cdr s))))
    (else
      (cons
        (cons (car s) (car (nondecreaselist (cdr s))))
        (cdr (nondecreaselist (cdr s)))))
  )
)
```

